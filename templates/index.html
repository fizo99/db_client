{% extends 'layout.html' %}

{% block body %}
<div class="jumbotron">
    <h1 class="display-4">Databases</h1>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
      {%for i in range(0, len)%}
        <tr>
          <th scope="row">{{i}}</th>
          <td>{{databases[i]}}</td>
          <td><button data-arg={{databases[i]}} onClick="chooseDB()" class="btn btn-light">Choose</button></td>
        </tr>
      {%endfor%}
      </tbody>
    </table>
    <div class="d-flex flex-row-reverse mt-5">
      <button onClick="createDB()" class="btn btn-light col-2 ml-2">Create</button>
      <input class="form-control col-3" type="text" id="dbNameField" placeholder="DB name">
    </div>
</div>
<script>
  async function chooseDB(){
    let dbName = event.target.getAttribute('data-arg');
    localStorage.setItem('dbName',dbName)

    window.location.replace(`http://localhost:5000/tables/${dbName}`);
  }
  async function createDB(){
    const name = document.querySelector("#dbNameField").value;
    if(name.includes(".")){
      alert("Insert name without extension");
      return;
    }
    fetch(`http://localhost:5000/database/create/${name}`)
    .then(res => {
      if(res.ok)
        return res.json()
      else
        throw new Exception(); 
    })
    .then(json => {
      alert("Database created")
      window.location.replace(`http://localhost:5000`);
    })
    .catch(ex => {
      alert("Error while creating database")
    })

  }
</script>
{% endblock %}
